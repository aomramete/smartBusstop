from flask import Flask, request, jsonify
from flask_restful import Resource, Api
from math import sin, cos, sqrt, atan2, radians
import random
import json

app = Flask(__name__)
api = Api(app)

import requests
import time

def distance():
	R = 6373.0
	lat1 = radians(13.727154)
	lon1 = radians(100.774713)
	lat2 = radians(13.727208)
	lon2 = radians(100.776801)
	dlon = lon2 - lon1
	dlat = lat2 - lat1
	a = (sin(dlat/2))**2 + cos(lat1) * cos(lat2) * (sin(dlon/2))**2
	c = 2 * atan2(sqrt(a), sqrt(1-a))
	distance = R * c
	meter = distance*1000
	# Define speed and times
	speed = meter/300 # 300 is seconds (arriving in time)
	time = (meter/speed)/60
	print ("Estimated arriving time: ", time)

class busstop(Resource):
        def get(self, location):
                url = "http://35.208.101.91:8080/sensors/project_id/flood_detector/" + location
                response = requests.get(url)
                busstop = response.json()
                data = []
                for i in range(len(flood_status)):
                        coming_data = {'sensor_id':flood_status[i]['sensor_id'], 'flood_status':waterlevel_status(int(flood_status[i]["sensor_data"])), 'flood_percentage':waterlevel(i$
                        print(data)
                        data.append(coming_data)
                        print(waterlevel_status(int(flood_status[i]["sensor_data"])))
                return json.dumps(data)

api.add_resource(flood_status, '/flood_detector/<location>')

if __name__ == '__main__':
     app.run(host = '0.0.0.0', port='8080', threaded=True, debug=True)
